<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no"
    />
    <meta content="no-cache,must-revalidate" http-equiv="Cache-Control" />
    <meta content="no-cache" http-equiv="pragma" />
    <meta content="0" http-equiv="expires" />
    <title>一起看烟花吧</title>
    <script src="assets/pizzicato.js"></script>
  </head>
  <body>
    <div id="app">
      <!-- 烟花 -->
    </div>
  </body>
  <script>
    javascript: !(function () {
      var cdom = document.createElement("canvas");
      cdom.id = "myCanvas";
      cdom.style.position = "fixed";
      cdom.style.left = "0";
      cdom.style.top = "0";
      cdom.style.zIndex = -1;
      document.body.appendChild(cdom);
      var canvas = document.getElementById("myCanvas");
      var context = canvas.getContext("2d");
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resizeCanvas, false);
      resizeCanvas();
      clearCanvas();
      function clearCanvas() {
        context.fillStyle = "#000000";
        context.fillRect(0, 0, canvas.width, canvas.height);
      }
      function mouseDownHandler(e) {
        playBoom()
        console.log(window.innerWidth,window.innerHeight)
        var x = e.clientX;
        var y = e.clientY;
        fire(x, y);
        setTimeout( function(){ 
          playPilipala() 
        }, 600);
      }
      var rid;
      var particles = [];
      function fire(x, y) {
        particles = [];
        createFireworks(x, y,Math.random() * 255);
        for (let index = 0; index < 5; index++) {
          createFireworks(Math.random() * window.innerWidth,Math.random() * window.innerHeight,Math.random() * 255);
        }
        function tick() {
          context.globalCompositeOperation = "destination-out";
          context.fillStyle = "rgba(0,0,0," + 10 / 100 + ")";
          context.fillRect(0, 0, canvas.width, canvas.height);
          context.globalCompositeOperation = "lighter";
          drawFireworks();
          rid = requestAnimationFrame(tick);
        }
        cancelAnimationFrame(rid);
        tick();
      }
      
      function createFireworks(sx, sy,sc) {
        var hue = Math.floor(Math.random() * 51) + sc;
        var hueVariance = 30;
        var count = 100;
        for (var i = 0; i < count; i++) {
          var p = {};
          var angle = Math.floor(Math.random() * 360);
          p.radians = (angle * Math.PI) / 180;
          p.x = sx;
          p.y = sy;
          p.speed = Math.random() * 5 + 0.4;
          p.radius = p.speed;
          p.size = Math.floor(Math.random() * 3) + 1;
          p.hue =
            Math.floor(
              Math.random() * (hue + hueVariance - (hue - hueVariance))
            ) +
            (hue - hueVariance);
          p.brightness = Math.floor(Math.random() * 31) + 50;
          p.alpha = (Math.floor(Math.random() * 61) + 40) / 100;
          particles.push(p);
        }
      }
      function drawFireworks() {
        clearCanvas();
        for (var i = 0; i < particles.length; i++) {
          var p = particles[i];
          var vx = Math.cos(p.radians) * p.radius;
          var vy = Math.sin(p.radians) * p.radius + 0.4;
          p.x += vx;
          p.y += vy;
          p.radius *= 1 - p.speed / 100;
          p.alpha -= 0.005;
          context.beginPath();
          context.arc(p.x, p.y, p.size, 0, Math.PI * 2, false);
          context.closePath();
          context.fillStyle =
            "hsla(" + p.hue + ", 100%, " + p.brightness + "%, " + p.alpha + ")";
          context.fill();
        }
      }


      function playBoom() {
        var acousticGuitar = new Pizzicato.Sound('./assets/boom.mp3', function() {
            // Sound loaded!
            acousticGuitar.play();
        });
      }
      function playPilipala() {
        var acousticGuitar = new Pizzicato.Sound('./assets/pilipala.mp3', function() {
            // Sound loaded!
            acousticGuitar.play();
        });
      }
      
      document.addEventListener("mousedown", mouseDownHandler, false);

      // 随机播放
      
    })();
  
  </script>
</html>
